<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Parameters Sample</title>

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
    integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
    integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>

  <script src="tableau-ui.min.js"></script>
  <script src="../../lib/tableau.extensions.1.latest.js"></script>

</head>

<body>

    <table class="table table-bordered table-sm m-0 p-0" style="width: 225px;">
      <tbody>
        <tr class="table-light" style="height: 20px;">
          <td class="text-center align-middle p-0 m-0" style="width: 125px;">
            Refresh Every
          </td>
          <td class="text-center align-middle p-0 m-0" style="width: 100px;">
            Refresh In
          </td>

        </tr>

        <tr class="table-light" style="height: 40px;">
          <td class="text-center align-middle">
            <select id="refresh" class="form-control  form-control-sm m-0" onchange="updateInterval(this.value)">
              <option value="10000">10 Seconds</option>
              <option value="30000">30 Seconds</option>
              <option value="60000" selected>1 Minute</option>
              <option value="300000">5 Minutes</option>
            </select>


          </td>
          <td class="text-center align-middle">
            <h4 class="text-danger m-0 p-0 " id="counter"></h4>
          </td>

        </tr>
      </tbody>

    </table>

</body>

<script>
  var viz

  var refreshInterval = 60000
  var duration = refreshInterval

  function refreshView() {
    duration = refreshInterval
  }

  function updateInterval(value) {
    clearInterval(interval);
    interval = setInterval(refreshView, parseInt(value));
    refreshView();
    refreshInterval = parseInt(value)
    clearInterval(countDownInterval)
    duration = refreshInterval
    countDownInterval = setInterval(countDown, 1000);
  }

  var interval = setInterval(refreshView, refreshInterval);

  function countDown() {

    duration -= 1000

    if (duration < 0) {
      duration = 0
    }

    // Time calculations for days, hours, minutes and seconds
    var minutes = String(Math.floor((duration % (1000 * 60 * 60)) / (1000 * 60)));
    var seconds = ("0" + String(Math.floor((duration % (1000 * 60)) / 1000))).slice(-2);

    // Display the result in the element with id="demo"
    var element = document.getElementById("counter")

    element.innerHTML = minutes + ":" + seconds;

    if (duration <= 5000) {
      element.classList.add('text-danger')
    } else {
      element.classList.remove('text-danger')
    }
  }

  // Update the count down every 1 second
  var countDownInterval = setInterval(countDown, 1000);
</script>

</html>